var BLASS=BLASS||{};BLASS.EmailAddressInput={_inputTable:null,_tableObj:null,_inputDiv:null,_virtualAddressInput:null,_inputStyle:null,_inputRuler:null,_addressBoxUl:null,_addressBoxList:null,_addressBoxId:0,_addressBoxIdPrefix:"__BLASS_EMAILINPUT_",_autoCompleteHandler:null,_autoCompleteCallback:null,_autoCompleteDiv:null,_autoCompleteData:null,_autoCompleteResult:null,_autoCompleteLast:null,_selectedAutoCompleteIndex:-1,_selectedAutoCompleteProcess:true,_growSize:0,_checkInputInterval:250,_checkInput:false,_checkInputCounter:3,_checkInputBuffer:null,_existCSS:false,init:function(c,b,a){if(c){this._inputTable=c}if(this._inputTable){this._tableObj=document.getElementById(this._inputTable)}if(a){if(a.handler){this._autoCompleteHandler=a.handler}if(a.callback){this._autoCompleteCallback=a.callback}}this._inputStyle={border:(b&&b.border)?b.border:"solid 1px #b5b5b5",backgroundColor:(b&&b.backgroundColor)?b.backgroundColor:"#ffffff",width:(b&&b.width)?b.width:"100%",fontSize:(b&&b.fontSize)?b.fontSize:"12px",id:(b&&b.id)?b.id:""};this._addressBoxList=new Array();this._createCSS();this._createInput()},clone:function(d,b){if(!b&&!d){d=this}if(d==null||typeof(d)!="object"){return d}var a=new d.constructor();for(var c in d){a[c]=d.clone(d[c],true)}a._existCSS=true;return a},_createInput:function(){if(!this._tableObj){return}this._inputDiv=this._getInput();this._inputRuler=this._getRuler();this._addressBoxUl=this._getAddressBoxUl();var a=this._getAddressBoxLi();this._addressBoxList.push(a);this._virtualAddressInput=this._getVirtualAddressInput();this._autoCompleteDiv=this._getAutoComplete();a.appendChild(this._virtualAddressInput);this._addressBoxUl.appendChild(a);this._inputDiv.appendChild(this._inputRuler);this._inputDiv.appendChild(this._addressBoxUl);this._tableObj.appendChild(this._inputDiv);this._tableObj.appendChild(this._autoCompleteDiv);this._inputDiv.blass=this;this._virtualAddressInput.blass=this;this._inputDiv.onclick=function(b){this.blass._focusVirtualAddressInput(b)};this._virtualAddressInput.onkeyup=function(b){return this.blass._createAddressInput(b,this)};this._virtualAddressInput.onkeydown=function(b){return this.blass._createAddressSpecialInput(b,this)};this._virtualAddressInput.onkeypress=function(b){this.blass._checkInput=true;this.blass._checkInputData()};this._virtualAddressInput.onblur=function(b){this.blass._createAddressInput({keyCode:13},this);this.blass._checkInput=false}},_getAutoComplete:function(){var a=document.createElement("div");a.className="blass_eai_ac";return a},_setAutoCompleteData:function(a){if(!this._autoCompleteHandler||!this._selectedAutoCompleteProcess||!a){return}this._selectedAutoCompleteProcess=false;this._resetAutoCompleteData();this._autoCompleteLast=a;if(!this._autoCompleteCallback){this._autoCompleteData=this._autoCompleteHandler(a);this._showAutoCompleteLayer()}else{this._autoCompleteCallback.blass=this;this._autoCompleteHandler(a,this._autoCompleteCallback)}},setAutoCompleteCallBack:function(a){this._autoCompleteData=a;this._showAutoCompleteLayer()},_showAutoCompleteLayer:function(){this._selectedAutoCompleteProcess=true;if(!this._autoCompleteData||this._autoCompleteData.length==0){return}for(var a=0;a=0){this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_normal"}this._selectedAutoCompleteIndex+=a;if(this._selectedAutoCompleteIndex<0){this._selectedAutoCompleteIndex=-1;return}if(this._selectedAutoCompleteIndex<0){this._selectedAutoCompleteIndex=0}if(this._selectedAutoCompleteIndex>=this._autoCompleteResult.length){this._selectedAutoCompleteIndex=this._autoCompleteResult.length-1}this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_select"},_resetAutoCompleteData:function(){this._autoCompleteDiv.style.visibility="hidden";for(r=this._autoCompleteDiv.childNodes.length-1;r>=0;r--){this._autoCompleteDiv.removeChild(this._autoCompleteDiv.childNodes[r])}this._selectedAutoCompleteIndex=-1;this._autoCompleteData=null;this._autoCompleteResult=new Array()},_getAddressBoxId:function(){return this._addressBoxIdPrefix+this._inputStyle.id+(++this._addressBoxId)},_getInput:function(){var a=document.createElement("div");a.className="blass_eai_inputdiv";a.width=this._inputStyle.width;return a},_getRuler:function(){var a=document.createElement("div");a.className="blass_eai_ruler";a.width=this._inputStyle.width;return a},_getAddressBoxLi:function(){var a=document.createElement("li");a.id=this._getAddressBoxId();a.className="blass_eai_li";return a},_getAddressBoxUl:function(){var a=document.createElement("ul");a.className="blass_eai_ul";return a},_getVirtualAddressInput:function(){var a=document.createElement("input");a.type="text";a.className="blass_eai_input";return a},_focusVirtualAddressInput:function(){this._virtualAddressInput.select();this._virtualAddressInput.focus()},getAddresses:function(){var b="";for(var a=1;a0;a--){this._removeAddressBox(this._addressBoxList[a].id)}this._resetVirtualAddressInput();this._resetAutoCompleteData()},_resetVirtualAddressInput:function(){this._virtualAddressInput.value="";this._inputRuler.innerHTML=""},_removeAddressBox:function(d){if(this._addressBoxList.length<=1){return}if(!d){d=this._addressBoxList[this._addressBoxList.length-1].id}var a=document.getElementById(d);var c=new Array();for(var b=0;b=0){d.value=this._autoCompleteData[this._selectedAutoCompleteIndex].text;b=this._autoCompleteData[this._selectedAutoCompleteIndex].value;c=true}d.value=d.value.replace(/^[,;\s]*/,"").replace(/[,;\s]*$/,"");if(!b){b=d.value}if(d.value==""){return}this._resetAutoCompleteData();this.createAddressBox({text:d.value,value:b,validation:c});this._resetVirtualAddressInput();break;case 27:this._resetAutoCompleteData();this._resetVirtualAddressInput();break;case 40:case 38:break;default:this._inputRuler.innerHTML=d.value;break}this._resizeVirtualAddressInput();return !(e.keyCode==13)},_createAddressSpecialInput:function(b,c){var a=true;var d=(b)?b:event;switch(d.keyCode){case 8:if(c.value==""){this._resetAutoCompleteData();this._removeAddressBox()}break;case 40:case 38:this._selectAutoCompleteData((d.keyCode==40)?1:-1);break;default:break}this._resizeVirtualAddressInput();return !(d.keyCode==13)},_checkInputResetCounter:function(){this._checkInputCounter=2},_checkInputData:function(){if(this._checkInput){var a=this;setTimeout(function(){if(a._checkInputBuffer!=a._virtualAddressInput.value){a._checkInputResetCounter();a._checkInputBuffer=a._virtualAddressInput.value}else{if(a._checkInputBuffer&&a._autoCompleteLast!=a._checkInputBuffer){--a._checkInputCounter;if(a._checkInputCounter<=0){a._checkInputResetCounter();a._setAutoCompleteData(a._virtualAddressInput.value)}}}a._checkInputData()},this._checkInputInterval)}},_resizeVirtualAddressInput:function(){this._virtualAddressInput.style.width=this.getInputWidth(this._inputRuler)},getInputWidth:function(b){var a=b.offsetWidth+20;if(a<50){a=50}return a+"px"},validation:function(a){var b=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return b.test(a)}};