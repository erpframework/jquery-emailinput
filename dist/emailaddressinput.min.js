/*! emailaddressinput.js - v1.0.1 - 2013-11-10
* https://github.com/jongha/emailaddressinput.js
* Copyright (c) 2013 Jong-Ha Ahn; Licensed MIT */
var EmailAddressInput={_inputTable:null,_tableObj:null,_inputDiv:null,_virtualAddressInput:null,_inputStyle:null,_inputRuler:null,_addressBoxUl:null,_addressBoxList:null,_addressBoxId:0,_addressBoxIdPrefix:"__BLASS_EMAILINPUT_",_autoCompleteHandler:null,_autoCompleteCallback:null,_autoCompleteDiv:null,_autoCompleteData:null,_autoCompleteResult:null,_autoCompleteLast:null,_selectedAutoCompleteIndex:-1,_selectedAutoCompleteProcess:!0,_growSize:0,_checkInputInterval:250,_checkInput:!1,_checkInputCounter:3,_checkInputBuffer:null,_existCSS:!1,init:function(a,b,c){"use strict";a&&(this._inputTable=a),this._inputTable&&(this._tableObj=document.getElementById(this._inputTable)),c&&(c.handler&&(this._autoCompleteHandler=c.handler),c.callback&&(this._autoCompleteCallback=c.callback)),this._inputStyle={border:b&&b.border?b.border:"solid 1px #b5b5b5",backgroundColor:b&&b.backgroundColor?b.backgroundColor:"#ffffff",width:b&&b.width?b.width:"100%",fontSize:b&&b.fontSize?b.fontSize:"12px",id:b&&b.id?b.id:""},this._addressBoxList=[],this._createCSS(),this._createInput()},clone:function(a,b){"use strict";if(b||a||(a=this),null===a||"object"!=typeof a)return a;var c,d=new a.constructor;for(c in a)a.hasOwnProperty(c)&&(d[c]=a.clone(a[c],!0));return d._existCSS=!0,d},_createInput:function(){"use strict";if(this._tableObj){this._inputDiv=this._getInput(),this._inputRuler=this._getRuler(),this._addressBoxUl=this._getAddressBoxUl();var a=this._getAddressBoxLi();this._addressBoxList.push(a),this._virtualAddressInput=this._getVirtualAddressInput(),this._autoCompleteDiv=this._getAutoComplete(),a.appendChild(this._virtualAddressInput),this._addressBoxUl.appendChild(a),this._inputDiv.appendChild(this._inputRuler),this._inputDiv.appendChild(this._addressBoxUl),this._tableObj.appendChild(this._inputDiv),this._tableObj.appendChild(this._autoCompleteDiv),this._inputDiv.blass=this,this._virtualAddressInput.blass=this,this._inputDiv.onclick=function(a){this.blass._focusVirtualAddressInput(a)},this._virtualAddressInput.onkeyup=function(a){return this.blass._createAddressInput(a,this)},this._virtualAddressInput.onkeydown=function(a){return this.blass._createAddressSpecialInput(a,this)},this._virtualAddressInput.onkeypress=function(){this.blass._checkInput=!0,this.blass._checkInputData()},this._virtualAddressInput.onblur=function(){this.blass._createAddressInput({keyCode:13},this),this.blass._checkInput=!1}}},_getAutoComplete:function(){"use strict";var a=document.createElement("div");return a.className="blass_eai_ac",a},_setAutoCompleteData:function(a){"use strict";this._autoCompleteHandler&&this._selectedAutoCompleteProcess&&a&&(this._selectedAutoCompleteProcess=!1,this._resetAutoCompleteData(),this._autoCompleteLast=a,this._autoCompleteCallback?(this._autoCompleteCallback.blass=this,this._autoCompleteHandler(a,this._autoCompleteCallback)):(this._autoCompleteData=this._autoCompleteHandler(a),this._showAutoCompleteLayer()))},setAutoCompleteCallBack:function(a){"use strict";this._autoCompleteData=a,this._showAutoCompleteLayer()},_showAutoCompleteLayer:function(){"use strict";if(this._selectedAutoCompleteProcess=!0,this._autoCompleteData&&0!==this._autoCompleteData.length){var a,b=function(a){a={keyCode:13},this.blass._selectedAutoCompleteIndex=this.index,this.blass._createAddressInput(a,this.blass._virtualAddressInput),this.blass._focusVirtualAddressInput()};for(a=0;a<this._autoCompleteData.length;++a){var c=document.createElement("div");c.innerHTML=this._autoCompleteData[a].text,c.className="blass_eai_aclayer",c.blass=this,c.index=a,c.onclick=b,this._autoCompleteDiv.appendChild(c),this._autoCompleteResult.push(c)}this._autoCompleteDiv.style.visibility="visible",this._selectAutoCompleteData(1)}},_selectAutoCompleteData:function(a){"use strict";if(this._autoCompleteData&&0!==this._autoCompleteData.length){if(this._selectedAutoCompleteIndex>=0&&(this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_normal"),this._selectedAutoCompleteIndex+=a,this._selectedAutoCompleteIndex<0)return this._selectedAutoCompleteIndex=-1,void 0;this._selectedAutoCompleteIndex<0&&(this._selectedAutoCompleteIndex=0),this._selectedAutoCompleteIndex>=this._autoCompleteResult.length&&(this._selectedAutoCompleteIndex=this._autoCompleteResult.length-1),this._autoCompleteResult[this._selectedAutoCompleteIndex].className="blass_eai_aclayer blass_eai_select"}},_resetAutoCompleteData:function(){"use strict";this._autoCompleteDiv.style.visibility="hidden";var a;for(a=this._autoCompleteDiv.childNodes.length-1;a>=0;a--)this._autoCompleteDiv.removeChild(this._autoCompleteDiv.childNodes[a]);this._selectedAutoCompleteIndex=-1,this._autoCompleteData=null,this._autoCompleteResult=[]},_getAddressBoxId:function(){"use strict";return this._addressBoxIdPrefix+this._inputStyle.id+ ++this._addressBoxId},_getInput:function(){"use strict";var a=document.createElement("div");return a.className="blass_eai_inputdiv",a.width=this._inputStyle.width,a},_getRuler:function(){"use strict";var a=document.createElement("div");return a.className="blass_eai_ruler",a.width=this._inputStyle.width,a},_getAddressBoxLi:function(){"use strict";var a=document.createElement("li");return a.id=this._getAddressBoxId(),a.className="blass_eai_li",a},_getAddressBoxUl:function(){"use strict";var a=document.createElement("ul");return a.className="blass_eai_ul",a},_getVirtualAddressInput:function(){"use strict";var a=document.createElement("input");return a.type="text",a.className="blass_eai_input",a},_focusVirtualAddressInput:function(){"use strict";this._virtualAddressInput.select(),this._virtualAddressInput.focus()},focus:function(){"use strict";this._focusVirtualAddressInput()},getAddresses:function(){"use strict";var a,b="";for(a=1;a<this._addressBoxList.length;a++)this._addressBoxList[a].objValue&&this._addressBoxList[a].isValid&&(b+=this._addressBoxList[a].objValue+",");return","===b.substr(b.length-1,1)&&(b=b.substr(0,b.length-1)),b},createAddressBox:function(a){"use strict";var b=a.text;if(""!==b){var c=a.validation?a.validation:this.validation(a.value),d=document.createElement("li");d.className="blass_eai_box "+(c?"blass_eai_valid":"blass_eai_invalid"),d.id=this._getAddressBoxId(),d.objValue=a.value,d.isValid=c;var e=document.createElement("span");e.className="blass_eai_address",e.innerHTML=b,d.appendChild(e);var f=document.createElement("span");f.className="blass_eai_delete",d.appendChild(f),f.blass=this,f.onclick=function(){this.blass._removeAddressBox(this.parentNode.id)},this._addressBoxUl.insertBefore(d,this._addressBoxList[0]),this._addressBoxList.push(d)}},_createCSS:function(){"use strict";var a="blass_eai";if(!this._existCSS&&!document.getElementById(a)){var b=document.createElement("style");b.id=a;var c=".blass_eai_ac { border: solid 1px #cccccc; width: 500px; visibility: hidden; position: absolute; background-color:#ffffff; padding: 5px; z-index: 1000; font-size:"+this._inputStyle.fontSize+"; }";c+=".blass_eai_aclayer { padding: 0px 0px 3px 0px; cursor:pointer }",c+=".blass_eai_select { font-weight: bold; }",c+=".blass_eai_normal { font-weight: normal; }";var d=!1;if("Microsoft Internet Explorer"===navigator.appName){var e=navigator.userAgent,f=parseInt(e.substring(e.indexOf("MSIE ")+5),null);6>=f&&(d=!0,c+=".blass_eai_inputdiv { height: 22px; padding:1px; cursor:text; border:"+this._inputStyle.border+"; }")}if(d||(c+=".blass_eai_inputdiv { max-height: 52px; overflow-y: auto; padding:1px; cursor:text; border:"+this._inputStyle.border+"; }"),c+=".blass_eai_li { margin-left:6px; }",c+=".blass_eai_ul { list-style-type:none; margin:0px; padding:0px; }",c+=".blass_eai_input { outline:none; width:50px; height: 18px; margin-top: 3px; padding:0px 0px 0px 3px; border:0px solid #ffffff; overflow:hidden; float:left; }",c+=".blass_eai_box { display:block; margin:1px; padding:1px 3px; width:auto; float:left; }",c+=".blass_eai_ruler { position: absolute; overflow:hidden; visibility:hidden; z-index:-1; }",c+=".blass_eai_valid { border:1px solid #bbd8fb; background-color:#f3f7fd; }",c+=".blass_eai_invalid { border:1px solid #b55e5e; background-color:#fdf5f5; }",c+=".blass_eai_delete { cursor:pointer; margin:5px 0px 0px 5px; float:left; width:9px; height:9px; }",c+=".blass_eai_valid .blass_eai_delete { background:url(data:image/gif;base64,R0lGODlhCQAJAKIAAJu226O83pOx15u32////////wAAAAAAACH5BAEAAAUALAAAAAAJAAkAAAMaGLo6ATAC8Ui0FFo7n44ZsEEZJ3YSOAhsyyYAOw==) no-repeat; }",c+=".blass_eai_invalid .blass_eai_delete { background:url(data:image/gif;base64,R0lGODlhCQAJAKIAALukpaqQkrSanKKGif708v///wAAAAAAACH5BAEAAAUALAAAAAAJAAkAAAMaCLoqEDCG8Ui0FFo7n45ZsEEZJ3YSOKwsmwAAOw==) no-repeat; }",c+=".blass_eai_address { float:left; }",b.setAttribute("type","text/css"),b.styleSheet)b.styleSheet.cssText=c;else{var g=document.createTextNode(c);b.appendChild(g)}var h=document.getElementsByTagName("head")[0];h&&h.appendChild(b),this._existCSS=!0}},removeAllAddressBox:function(){"use strict";if(!(this._addressBoxList.length<=1)){var a;for(a=this._addressBoxList.length-1;a>0;a--)this._removeAddressBox(this._addressBoxList[a].id);this._resetVirtualAddressInput(),this._resetAutoCompleteData()}},_resetVirtualAddressInput:function(){"use strict";this._virtualAddressInput.value="",this._inputRuler.innerHTML=""},_removeAddressBox:function(a){"use strict";if(!(this._addressBoxList.length<=1)){a||(a=this._addressBoxList[this._addressBoxList.length-1].id);var b,c=[];for(b=0;b<this._addressBoxList.length;b++)this._addressBoxList[b].id!==a&&c.push(this._addressBoxList[b]);this._addressBoxList=c,this._addressBoxUl.removeChild(document.getElementById(a))}},_intervalCheckInput:function(){"use strict";setTimeout(this._intervalCheckInput(),1e3)},_createAddressInput:function(a,b){"use strict";var c=a||event;switch(c.keyCode){case 13:case 32:case 186:case 188:var d=null,e=null;if(this._autoCompleteData&&this._selectedAutoCompleteIndex>=0&&(b.value=this._autoCompleteData[this._selectedAutoCompleteIndex].text,e=this._autoCompleteData[this._selectedAutoCompleteIndex].value,d=!0),b.value=b.value.replace(/^[,;\s]*/,"").replace(/[,;\s]*$/,""),e||(e=b.value),""===b.value)return;this._resetAutoCompleteData(),this.createAddressBox({text:b.value,value:e,validation:d}),this._resetVirtualAddressInput();break;case 27:this._resetAutoCompleteData(),this._resetVirtualAddressInput();break;case 40:case 38:break;default:this._inputRuler.innerHTML=b.value}return this._resizeVirtualAddressInput(),13!==c.keyCode},_createAddressSpecialInput:function(a,b){"use strict";var c=a||event;switch(c.keyCode){case 8:""===b.value&&(this._resetAutoCompleteData(),this._removeAddressBox());break;case 40:case 38:this._selectAutoCompleteData(40===c.keyCode?1:-1)}return this._resizeVirtualAddressInput(),13!==c.keyCode},_checkInputResetCounter:function(){"use strict";this._checkInputCounter=2},_checkInputData:function(){"use strict";if(this._checkInput){var a=this;setTimeout(function(){a._checkInputBuffer!==a._virtualAddressInput.value?(a._checkInputResetCounter(),a._checkInputBuffer=a._virtualAddressInput.value):a._checkInputBuffer&&a._autoCompleteLast!==a._checkInputBuffer&&(--a._checkInputCounter,a._checkInputCounter<=0&&(a._checkInputResetCounter(),a._setAutoCompleteData(a._virtualAddressInput.value))),a._checkInputData()},this._checkInputInterval)}},_resizeVirtualAddressInput:function(){"use strict";this._virtualAddressInput.style.width=this.getInputWidth(this._inputRuler)},getInputWidth:function(a){"use strict";var b=a.offsetWidth+20;return 50>b&&(b=50),b+"px"},validation:function(a){"use strict";var b=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return b.test(a)}};